<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ĞŸĞ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#bcd1e8;
  --panel:#f6f6f6;
  --line:#d8d8d8;
  --text:#12151a;
}
*{box-sizing:border-box;margin:0;padding:0;font-family:'Montserrat',sans-serif}
body{background:var(--bg);color:var(--text)}
.layout{min-height:100vh;display:grid;grid-template-columns:112px 445px 1fr}

.mini-sidebar{
  background:var(--panel);
  border-right:1px solid var(--line);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:space-between;
  padding:16px 0 20px;
}
.mini-top{width:100%;display:flex;flex-direction:column;align-items:center}
.mini-logo{width:78px;height:auto}
.mini-nav{
  width:100%;
  display:flex;
  flex-direction:column;
  justify-content:flex-start;
  align-items:center;
  gap:18px;
  margin-top:16px;
}
.mini-link{
  width:44px;height:44px;
  display:flex;align-items:center;justify-content:center;
  border-radius:12px;
}
.mini-link svg{width:34px;height:34px;stroke:#8a8f98;stroke-width:1.8;fill:none}
.mini-link.active svg{stroke:#6f747c}
.mini-user img,.mini-avatar{width:44px;height:44px;border-radius:50%;object-fit:cover}
.mini-avatar{background:#cfd5df}

.list-panel{
  background:var(--panel);
  border-right:1px solid var(--line);
  display:flex;
  flex-direction:column;
}
.list-head{
  padding:24px 30px 12px;
  font-size:30px;
  line-height:36px;
  font-weight:700;
  text-align:center;
}
.list-scroll{
  overflow:auto;
  padding:6px 10px 10px 20px;
}
.item{
  display:grid;
  grid-template-columns:58px 1fr auto;
  gap:14px;
  align-items:center;
  text-decoration:none;
  color:inherit;
  border-radius:12px;
  padding:10px 8px;
  min-width:0;
}
.item.active{background:#ededed}
.item-avatar{width:58px;height:58px;border-radius:50%;object-fit:cover}
.item-main{min-width:0;}
.item-name{font-size:19px;line-height:24px;font-weight:500}
.item-sub{
  margin-top:3px;
  font-size:15px;
  line-height:22px;
  color:#2a2d34;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  max-width:100%;
}
.item-side{
  display:flex;
  align-items:center;
  gap:8px;
  font-size:16px;
  line-height:20px;
  flex-shrink:0;
}
.item-ticks{
  width:18px;
  height:18px;
  fill:none;
  stroke:#12151a;
  stroke-width:1.6;
}

.chat-panel{
  min-width:0;
  display:flex;
  flex-direction:column;
}
.chat-head{
  background:var(--panel);
  border-bottom:1px solid var(--line);
  padding:16px 28px;
  display:flex;
  align-items:center;
  justify-content:space-between;
}
.chat-head-left{display:flex;align-items:center;gap:14px}
.chat-head-avatar{width:56px;height:56px;border-radius:50%;object-fit:cover}
.chat-head-name{font-size:26px;line-height:32px;font-weight:500}
.info-icon{width:38px;height:38px;fill:none;stroke:#111;stroke-width:1.45}

.chat-body{
  flex:1;
  overflow:auto;
  padding:18px 26px 14px;
}
.day-label{
  text-align:center;
  font-size:19px;
  line-height:24px;
  margin-bottom:14px;
}
.bubble{
  display:block;
  width:fit-content;
  max-width:62%;
  background:#f4f4f4;
  border-radius:20px;
  padding:12px 16px 8px;
  margin-bottom:14px;
}
.bubble.mine{margin-left:auto}
.bubble-text{font-size:17px;line-height:30px;word-wrap:break-word}
.bubble-meta{
  margin-top:4px;
  display:flex;
  justify-content:flex-end;
  align-items:center;
  gap:6px;
  font-size:17px;
  line-height:20px;
}
.bubble-ticks{
  width:20px;height:20px;
  fill:none;stroke:#111;stroke-width:1.8;
}

.empty-chat{
  flex:1;
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  font-size:45px;
  line-height:52px;
}

.input-wrap{
  padding:0 18px 16px;
  position:relative;
}
.input-form{
  background:#f5f5f5;
  border-radius:28px;
  display:flex;
  align-items:center;
  gap:10px;
  padding:12px 16px;
}
.input-icon{
  width:30px;height:30px;
  fill:none;stroke:#111;stroke-width:1.45;
}
.input{
  flex:1;
  border:none;
  outline:none;
  background:transparent;
  font-size:20px;
  line-height:26px;
}
.emoji-btn{
  border:none;
  background:transparent;
  padding:0;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}
.emoji-picker{
  position:absolute;
  right:76px;
  bottom:84px;
  width:356px;
  background:#fff;
  border:1px solid #dde2ea;
  border-radius:14px;
  box-shadow:0 12px 24px rgba(0,0,0,.16);
  padding:10px 10px 8px;
  display:none;
  z-index:20;
  overflow:hidden;
}
.emoji-picker.open{display:block}
.emoji-grid{
  display:grid;
  grid-template-columns:repeat(10,minmax(0,1fr));
  column-gap:4px;
  row-gap:6px;
  width:100%;
}
.emoji-item{
  border:none;
  background:transparent;
  font-size:24px;
  line-height:1;
  width:100%;
  padding:5px 0;
  cursor:pointer;
  border-radius:8px;
  display:flex;
  align-items:center;
  justify-content:center;
}
.emoji-item:hover{background:#eef3fa}
</style>
</head>
<body>
<div class="layout">
  <aside class="mini-sidebar">
    <div class="mini-top">
      <img src="/images/logo-2.png" alt="SoulLink" class="mini-logo">
      <nav class="mini-nav">
        <a class="mini-link" href="/dating/" aria-label="Ğ—Ğ½Ğ°Ğ¹Ğ¾Ğ¼ÑÑ‚Ğ²Ğ°"><svg viewBox="0 0 24 24"><path d="M3 10.5 12 3l9 7.5V21a1 1 0 0 1-1 1h-5v-7h-6v7H4a1 1 0 0 1-1-1z"/></svg></a>
        <a class="mini-link" href="/sympathy/" aria-label="Ğ¡Ğ¸Ğ¼Ğ¿Ğ°Ñ‚Ñ–Ñ—"><svg viewBox="0 0 24 24"><path d="M10 13a5 5 0 0 1 0-7l1.5-1.5a5 5 0 0 1 7 7L17 13"/><path d="M14 11a5 5 0 0 1 0 7L12.5 19.5a5 5 0 1 1-7-7L7 11"/><path d="M8 12h8"/></svg></a>
        <a class="mini-link" href="/likes/" aria-label="Ğ›Ğ°Ğ¹ĞºĞ¸"><svg viewBox="0 0 24 24"><path d="M12 21s-7.2-4.2-9.5-8.2C.7 9.8 2 5.7 6.2 5.1c2.3-.3 4.2.7 5.8 2.8 1.6-2.1 3.5-3.1 5.8-2.8 4.2.6 5.5 4.7 3.7 7.7C19.2 16.8 12 21 12 21z"/></svg></a>
        <a class="mini-link active" href="/messages/" aria-label="ĞŸĞ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ"><svg viewBox="0 0 24 24"><path d="M22 3 11 14"/><path d="m22 3-7 18-4-8-8-4z"/></svg></a>
      </nav>
    </div>
    <a class="mini-user" href="/profile/" aria-label="ĞŸÑ€Ğ¾Ñ„Ñ–Ğ»ÑŒ">
      {% if current_user and current_user.photo %}<img src="{{ current_user.photo.url }}" alt="{{ current_user.name }}">{% else %}<div class="mini-avatar"></div>{% endif %}
    </a>
  </aside>

  <section class="list-panel">
    <div class="list-head">ĞŸĞ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ</div>
    <div class="list-scroll">
      {% for convo in conversations %}
        <a class="item {% if active_partner and active_partner.id == convo.partner.id %}active{% endif %}" href="/messages/{{ convo.partner.id }}/">
          {% if convo.partner.photo %}<img class="item-avatar" src="{{ convo.partner.photo.url }}" alt="{{ convo.partner.name }}">{% else %}<div class="mini-avatar item-avatar"></div>{% endif %}
          <div class="item-main">
            <div class="item-name">{{ convo.partner.name }}</div>
            <div class="item-sub">{% if convo.last_message %}{{ convo.last_message.text }}{% else %}Ğ¡ÑŒĞ¾Ğ³Ğ¾Ğ´Ğ½Ñ–{% endif %}</div>
          </div>
          <div class="item-side">
            {% if convo.is_mine and convo.last_message %}
              <svg class="item-ticks" viewBox="0 0 24 24"><path d="m3.5 13 3.2 3.3 5.3-5.6"/><path d="m10.6 13 3.2 3.3 6.7-7"/></svg>
            {% endif %}
            <span>{{ convo.time_label }}</span>
          </div>
        </a>
      {% endfor %}
    </div>
  </section>

  <section class="chat-panel">
    {% if active_partner %}
      <header class="chat-head">
        <div class="chat-head-left">
          {% if active_partner.photo %}<img class="chat-head-avatar" src="{{ active_partner.photo.url }}" alt="{{ active_partner.name }}">{% else %}<div class="mini-avatar chat-head-avatar"></div>{% endif %}
          <div class="chat-head-name">{{ active_partner.name }}</div>
        </div>
        <svg class="info-icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="8.5"/><path d="M12 10v6"/><path d="M12 7.2h.01"/></svg>
      </header>

      <div class="chat-body">
        <div class="day-label">Ğ¡ÑŒĞ¾Ğ³Ğ¾Ğ´Ğ½Ñ–</div>
        {% for m in thread_messages %}
          <div class="bubble {% if m.sender_id == current_user.id %}mine{% endif %}">
            <div class="bubble-text">{{ m.text }}</div>
            <div class="bubble-meta">
              <span>{{ m.created|date:"H:i" }}</span>
              {% if m.sender_id == current_user.id %}
                <svg class="bubble-ticks" viewBox="0 0 24 24"><path d="m3.5 13 3.2 3.3 5.3-5.6"/><path d="m10.6 13 3.2 3.3 6.7-7"/></svg>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="empty-chat">ĞĞ±ĞµÑ€Ñ–Ñ‚ÑŒ Ñ‡Ğ°Ñ‚.</div>
    {% endif %}

    <div class="input-wrap">
      <div class="emoji-picker" id="emojiPicker" aria-hidden="true">
        <div class="emoji-grid">
          <button class="emoji-item" type="button">ğŸ˜€</button><button class="emoji-item" type="button">ğŸ˜</button><button class="emoji-item" type="button">ğŸ˜‚</button><button class="emoji-item" type="button">ğŸ˜…</button><button class="emoji-item" type="button">ğŸ˜Š</button><button class="emoji-item" type="button">ğŸ˜‰</button><button class="emoji-item" type="button">ğŸ˜</button><button class="emoji-item" type="button">ğŸ˜˜</button><button class="emoji-item" type="button">ğŸ˜</button><button class="emoji-item" type="button">ğŸ™‚</button>
          <button class="emoji-item" type="button">ğŸ¤—</button><button class="emoji-item" type="button">ğŸ¤”</button><button class="emoji-item" type="button">ğŸ˜‡</button><button class="emoji-item" type="button">ğŸ˜Œ</button><button class="emoji-item" type="button">ğŸ™ƒ</button><button class="emoji-item" type="button">ğŸ˜‹</button><button class="emoji-item" type="button">ğŸ˜„</button><button class="emoji-item" type="button">ğŸ˜ƒ</button><button class="emoji-item" type="button">ğŸ˜†</button><button class="emoji-item" type="button">ğŸ˜œ</button>
          <button class="emoji-item" type="button">ğŸ‘</button><button class="emoji-item" type="button">ğŸ‘</button><button class="emoji-item" type="button">ğŸ‘</button><button class="emoji-item" type="button">ğŸ™Œ</button><button class="emoji-item" type="button">ğŸ”¥</button><button class="emoji-item" type="button">ğŸ’¯</button><button class="emoji-item" type="button">âœ¨</button><button class="emoji-item" type="button">â­</button><button class="emoji-item" type="button">ğŸ‰</button><button class="emoji-item" type="button">ğŸŠ</button>
          <button class="emoji-item" type="button">â¤</button><button class="emoji-item" type="button">ğŸ§¡</button><button class="emoji-item" type="button">ğŸ’›</button><button class="emoji-item" type="button">ğŸ’š</button><button class="emoji-item" type="button">ğŸ’™</button><button class="emoji-item" type="button">ğŸ’œ</button><button class="emoji-item" type="button">ğŸ–¤</button><button class="emoji-item" type="button">ğŸ’”</button><button class="emoji-item" type="button">ğŸ’•</button><button class="emoji-item" type="button">ğŸ’–</button>
          <button class="emoji-item" type="button">ğŸ™</button><button class="emoji-item" type="button">ğŸ¤</button><button class="emoji-item" type="button">ğŸ’ª</button><button class="emoji-item" type="button">ğŸ‘Œ</button><button class="emoji-item" type="button">ğŸ‘€</button><button class="emoji-item" type="button">ğŸ™ˆ</button><button class="emoji-item" type="button">ğŸ¤·</button><button class="emoji-item" type="button">ğŸ’¬</button><button class="emoji-item" type="button">ğŸ“©</button><button class="emoji-item" type="button">âœ‰</button>
          <button class="emoji-item" type="button">â˜€</button><button class="emoji-item" type="button">ğŸŒˆ</button><button class="emoji-item" type="button">ğŸŒ¸</button><button class="emoji-item" type="button">ğŸ€</button><button class="emoji-item" type="button">â˜•</button><button class="emoji-item" type="button">ğŸ•</button><button class="emoji-item" type="button">ğŸµ</button><button class="emoji-item" type="button">ğŸ¬</button><button class="emoji-item" type="button">ğŸ</button><button class="emoji-item" type="button">ğŸŒŸ</button>
        </div>
      </div>

      <form class="input-form" method="POST" {% if not active_partner %}action=""{% endif %}>
        {% csrf_token %}
        <svg class="input-icon" viewBox="0 0 24 24"><path d="m21.4 11.2-8.9 8.9a6 6 0 0 1-8.5-8.5l9.2-9.2a4.3 4.3 0 0 1 6 6.2l-9.3 9.2a2.5 2.5 0 0 1-3.6-3.6l8-8"/></svg>
        <input class="input" id="chatInput" type="text" name="text" placeholder="ĞŸĞ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ..." autocomplete="off" {% if not active_partner %}disabled{% endif %}>
        <button class="emoji-btn" id="emojiToggle" type="button" aria-label="Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸ ĞµĞ¼Ğ¾Ğ´Ğ·Ñ–" {% if not active_partner %}disabled{% endif %}>
          <svg class="input-icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="8.5"/><circle cx="9.3" cy="10.2" r="0.65"/><circle cx="14.7" cy="10.2" r="0.65"/><path d="M8.8 14a4.2 4.2 0 0 0 6.4 0"/></svg>
        </button>
        <svg class="input-icon" viewBox="0 0 24 24"><rect x="9" y="3.5" width="6" height="11" rx="3"/><path d="M6.5 11.5a5.5 5.5 0 1 0 11 0"/><path d="M12 17v3.5"/><path d="M9 20.5h6"/></svg>
      </form>
    </div>
  </section>
</div>
<script>
const input = document.getElementById('chatInput');
const emojiToggle = document.getElementById('emojiToggle');
const emojiPicker = document.getElementById('emojiPicker');
const emojiItems = document.querySelectorAll('.emoji-item');

if (input && emojiToggle && emojiPicker) {
  emojiToggle.addEventListener('click', (e) => {
    e.stopPropagation();
    emojiPicker.classList.toggle('open');
    emojiPicker.setAttribute('aria-hidden', emojiPicker.classList.contains('open') ? 'false' : 'true');
  });

  emojiItems.forEach((btn) => {
    btn.addEventListener('click', () => {
      const emoji = btn.textContent || '';
      const start = input.selectionStart ?? input.value.length;
      const end = input.selectionEnd ?? input.value.length;
      input.value = input.value.slice(0, start) + emoji + input.value.slice(end);
      const next = start + emoji.length;
      input.focus();
      input.setSelectionRange(next, next);
    });
  });

  document.addEventListener('click', (e) => {
    if (!emojiPicker.contains(e.target) && !emojiToggle.contains(e.target)) {
      emojiPicker.classList.remove('open');
      emojiPicker.setAttribute('aria-hidden', 'true');
    }
  });
}
</script>
</body>
</html>
